<!-- Javascript -->
<script>
$(function () {
	var enrollment_chart, race_chart, isat_chart, mobility_chart;
    $(document).ready(function() {
    	//RACE CHART
    	race_chart = new Highcharts.Chart({
	            chart: {
	            	renderTo: 'race-chart',
	                type: 'bar'
	            },
	            credits: {enabled: false},
	            legend: { enabled: false },
	            plotOptions: {
	                bar: {
	                    borderWidth: 0,
	                    dataLabels: {
	                        enabled: true
	                    },
	                    groupPadding: 0,
	                    shadow: false
	                }
	            },
	            series: [{
	                data: <%= raw @school.races.map{ |r| r.percent} %>
	            }],
	            title: { text: '' },
	            tooltip: { enabled: false },
	            xAxis: {
	                categories: <%= raw @school.races.map{ |r| r.ethnicity }.inspect %>,
	                tickLength: 0
	            },
	            yAxis: {
	            	gridLineWidth: 0,
	                labels: { enabled: false },
	                title: { text: '' }
	            }
	    });
    
    	//ENROLLMENT CHART
        enrollment_chart = new Highcharts.Chart({
            chart: {
                renderTo: 'chart-enrollment',
                type: 'line'
            },
            credits: {enabled: false},
            legend: {enabled:false},
            plotOptions: {
	            line: {
	            	marker: {
		            	lineColor: "#fff",
		            	lineWidth: 1.5,
		            	radius: 5
	            	},
		            shadow: false
	            }
            },
            series: [{
                name: '20th Day Enrollment',
                data: <%= raw @school.enrollments.map{|e| if(e.count.nil?) then '' else e.count.to_i end} %>
            }],
            subtitle: { text: ''}, 
            title: { text: '' },
            tooltip: {
                formatter: function() {
                        return '<b>'+ this.series.name +'</b><br/>'+
                        this.x +': '+ this.y;
                }
            },
            xAxis: {
                categories: <%= raw @school.enrollments.map{|e| e.year_to.to_s} %>,
                gridLineColor: "#dfdfdf",
                gridLineWidth: 1,
                tickLength: 0
            },
            yAxis: {
            	gridLineColor: "#dfdfdf",
            	min: 0,
            	labels: {
	            	formatter: function(){
		            	return this.value;
	            	}
            	},
            	lineWidth: 1,
            	tickLength: 0,
                title: {
                    text: 'Number of students enrolled'
                }
            }
        });
        
        //ISAT CHART
        isat_chart = new Highcharts.Chart({
            chart: {
                renderTo: 'chart-isat',
                type: 'line'
            },
            credits: { enabled: false },
            legend: { borderWidth: 0 },
            plotOptions: {
	            line: {
	            	marker: {
		            	lineColor: "#fff",
		            	lineWidth: 1.5,
		            	radius: 5
	            	},
		            shadow: false
	            }
            },
            series: [{
                name: 'Reading',
                data: <%= raw @school.isat_scores.where("subject = 'Reading'").map{|s| if(s.percent.nil?) then '' else s.percent end} %>
            }, {
             name: 'Math',
                data: <%= raw @school.isat_scores.where("subject = 'Math'").map{|s| if(s.percent.nil?) then '' else s.percent end} %>
            }, {
             name: 'Science',
                data: <%= raw @school.isat_scores.where("subject = 'Science'").map{|s| if(s.percent.nil?) then '' else s.percent end} %>

            }],
            subtitle: { text: '' }, 
            title: { text: '' },
            tooltip: {
                borderColor: "#ccc",
                formatter: function() {
                	var s = "<strong>" + this.x + "</strong>";
                	
                	$.each(this.points, function(i, point){
                		if (point.y > 0)
	                		s += "<br />" + point.series.name + ": " + point.y + "%";
                	});
                	
                	return s;
                },
                shared: true
            },
            xAxis: {
                categories: <%= raw @school.isat_scores.map{|i| i.year_to}.inspect %>,
                gridLineColor: "#dfdfdf",
                gridLineWidth: 1,
                tickLength: 0
            },
            yAxis: {
            	gridLineColor: "#dfdfdf",
            	max: 100,
            	min: 0,
            	labels: {
	            	formatter: function(){
		            	return this.value + "%";
	            	}
            	},
            	lineWidth: 1,
            	tickLength: 0,
                title: {
                	style: { fontWeight: "normal" },
                    text: 'Students that meet or exceed state standards'
                }
            }
        });
        
        //MOBILITY CHART
        mobility_chart = new Highcharts.Chart({
            chart: {
                renderTo: 'chart-mobility',
                type: 'line',
                
                marginBottom: 25
            },
            title: {
                text: '',
                x: -20 //center
            },
            subtitle: {
                text: '',
           
            },
            xAxis: {
                categories: <%= raw @school.mobilities.map{ |mobility| mobility.year_to.to_s} %>
            },
            yAxis: {
                title: {
                    text: 'Rate'
                },
                plotLines: [{
                    value: 0,
                    width: 1
                }]
            },
            tooltip: {
                formatter: function() {
                        return '<b>'+ this.series.name +'</b><br/>'+
                        this.x +': '+ this.y;
                }
            },
            series: [{
                name: '',
                data: <%= raw @school.mobilities.map{|mobility| mobility.rate}.inspect %>
            }]
        });

    });
    
});

</script>

<!-- Map Script Section -->
<script type="text/javascript"
    src="http://maps.google.com/maps/api/js?sensor=false">
  </script>
  <script type="text/javascript">
    var map;
    var layerl0;
    function initialize() {
      map = new google.maps.Map(document.getElementById('map'), {
        center: new google.maps.LatLng( <%= @school.latitude %>, <%= @school.longitude %>),
        zoom: 13
      });
      var style = [
        {
          featureType: 'all',
          elementType: 'all',
          stylers: [
            { saturation: -88 }
          ]
        }
      ];
      var styledMapType = new google.maps.StyledMapType(style, {
        map: map,
        name: 'Styled Map'
      });
      map.mapTypes.set('map-style', styledMapType);
      map.setMapTypeId('map-style');
      var contentString = '<%= @school.short_name %>';

        var infowindow = new google.maps.InfoWindow({
            content: contentString,
            maxWidth: 100
        });

        var marker = new google.maps.Marker({
            position: new google.maps.LatLng( <%= @school.latitude %>, <%= @school.longitude %>),
            map: map,
            title: '<%= @school.short_name %>'
        });
         
      var circleOptions = {
        strokeColor: "#4b58a6",
        strokeOpacity: 0.5,
        strokeWeight: 1,
        fillColor: "#4b58a6",
        fillOpacity: 0.1,
        map: map,
        center: new google.maps.LatLng( <%= @school.latitude %>, <%= @school.longitude %>),
        clickable: false,
        zIndex: -1,
        radius: 1610
      };
      var onefiveOptions = {
        strokeColor: "#a64b58",
        strokeOpacity: 0.5,
        strokeWeight: 1,
        fillColor: "#a64b58",
        fillOpacity: 0.1,
        map: map,
        center: new google.maps.LatLng( <%= @school.latitude %>, <%= @school.longitude %>),
        clickable: false,
        zIndex: -1,
        radius: 2415
      };


      onefiveRadiusCircle = new google.maps.Circle(onefiveOptions);
      searchRadiusCircle = new google.maps.Circle(circleOptions);
      var LocationColumn = "Latitude"
      var fusionCPSID = "School ID"

      var whereClause = "'School ID'" + " not equal to '<%= @school.cps_id %>' AND " + "ST_INTERSECTS(" + "'col6'" + ", CIRCLE(LATLNG" + new google.maps.LatLng( <%= @school.latitude %>, <%= @school.longitude %>) + "," + 2415 + "))";

      layerl0 = new google.maps.FusionTablesLayer({
        query: {
          select: LocationColumn,
          from: '1OS3KLNS2j0F7X1KC9buWjn6fybfr8mBvWHtcAB0',
          where: whereClause
        },
        map: map,
        styleId: 2,
        templateId: 2,
      });

    
    }
    google.maps.event.addDomListener(window, 'load', initialize);
  </script>
<!-- End Javascript -->

<!-- Content -->
<div id="content">
    <div id="intro">
        <h1><%= link_to 'Home', root_url %> &raquo; <%= @school.short_name %></h1>
        <p><%= @school.full_name %> &bull; <%= @school.phone %> &bull; <%= @school.community_area %> &bull; <%= @school.street_address %>, Chicago, Illinois <%= @school.zip%></p>
        <div class="clear"></div>
    </div>
    
    <div id="profile-primary">
        <h2>Closest schools if this school is closed</h2>
        <p>If CPS closes <%= @school.short_name %>, students may be assigned to the schools below. <a href="#">More&hellip;</a></p>
        
        <div id="map"></div>
    </div>
    
    <div id="profile-secondary">
    	<p><a class="action" href="#comparison">Jump to evaluation data</a></p>
        
        <h2>Demographics</h2>
        
        <h3>Race/ethnicity</h3>
        <div id="race-chart"></div>
        <p><a href="http://www.cps.edu/Schools/Pages/school.aspx?id=<%= @school.cps_id %>">View more demographics at CPS.edu</a> &raquo;</p>
    </div>
    
    <div class="clear"></div><hr />
    
    <div id="compare">
        <!-- <h2>What does CPS look at and what else could be considered?</h2> -->
        
        <div class="c2l">
            <h3>Why is this school on the closing list?</h3>
            
            <div class="dataset">
                <h4>CPS Performance level</h4>
                <p>Need explanation. Atur, con nonsent offic tem fugita volestibus mo moluptio volore ut elloressi eium ius et in eatur se volup tatem exeratur qui derepud icatur More...</p>
                
                <div class="levels">
	                <ol>
	                	<li class=<%= if(@school.level=="Level 1") then @school.level.downcase.tr(' ','') end %>><strong>Level</strong><span>1</span></li>
	                	<li class=<%= if(@school.level=="Level 2") then @school.level.downcase.tr(' ','') end %>><strong>Level</strong><span>2</span></li>
	                	<li class=<%= if(@school.level=="Level 3") then @school.level.downcase.tr(' ','') end %>><strong>Level</strong><span>3</span></li>
	                </ol>
	                <!--<p><%= @school.level %></p>-->
	                <p class="mute">Lower is better</p>
                </div>
                
                <p class="mute">Source: <a href="http://www.cps.edu/Schools/Pages/school.aspx?id=<%= @school.cps_id %>">Chicago Public Schools School Profile</a></p>
            </div>
            <div class="dataset">
                <h4>CPS Utilization rate</h4>
                <p>Need explanation. Atur, con nonsent offic tem fugita volestibus mo moluptio volore ut elloressi eium ius et in eatur se volup tatem exeratur qui derepud icatur More...</p>
                <p class="mute">Source: <a href="http://cps.edu/About_CPS/Policies_and_guidelines/Pages/qualityschools.aspx">CPS Space Utilization and Enrollment Data for School Year 2012-2013</a></p>
            </div>
        </div>
        <div class="c2r">
            <h3>What do we know about this school?</h3>
                       
            <div class="dataset">
                <h4>Does student performance improve over time?</h4>
                <p>ISAT cohort trends. Need explanation. Atur, con nonsent offic tem fugita volestibus mo moluptio volore ut elloressi eium ius et in eatur se volup tatem exeratur qui derepud icatur More...</p>
                
                <div id="chart-isat"></div>
                
                <p class="mute">Source: <a href="#">IIRC Source</a></p>
            </div>
            <div class="dataset">
                <h4>Is this school organized for improvement?</h4>
                <p>UChicago's 5Essentials. Need explanation. Atur, con nonsent offic tem fugita volestibus mo moluptio volore ut elloressi eium ius et in eatur se volup tatem exeratur qui derepud icatur More...</p>
                
                <div class="essentials-charts">
                	<div class="c2l">
		                <!-- 2011 Essentials -->
		                <h4>2011</h4>
		                <div class="essentials">
						    <div class="category leaders <%= @school.essentials.where("category = 'leaders' AND year_to=2011").first.rating.tr(' ','-') %>" 
						    	title="<%= @school.essentials.where("category = 'leaders' AND year_to=2011").first.rating.capitalize %>">
						    	<span class="title">Effective leaders</span>
						    </div>
						    <div class="category teachers <%= @school.essentials.where("category = 'teachers' AND year_to=2011").first.rating.tr(' ','-') %>" 
						    	title="<%= @school.essentials.where("category = 'teachers' AND year_to=2011").first.rating.capitalize %>">
						    	<span class="title">Collaborative teachers</span>
						    </div>
						    <div class="category instruction <%= @school.essentials.where("category = 'instruction' AND year_to=2011").first.rating.tr(' ','-') %>" 
						    	title="<%= @school.essentials.where("category = 'instruction' AND year_to=2011").first.rating.capitalize %>">
						    	<span class="title">Ambitious instruction</span>
						    </div>
						    <div class="category environment <%= @school.essentials.where("category = 'environment' AND year_to=2011").first.rating.tr(' ','-') %>" 
						    	title="<%= @school.essentials.where("category = 'environment' AND year_to=2011").first.rating.capitalize %>">
						    	<span class="title">Supportive environment</span>
						    </div>
						    <div class="category families <%= @school.essentials.where("category = 'families' AND year_to=2011").first.rating.tr(' ','-') %>" 
						    	title="<%= @school.essentials.where("category = 'families' AND year_to=2011").first.rating.capitalize %>">
						    	<span class="title">Involved families</span>
						    </div>
						</div>
						<!-- /2011 Essentials -->
                	</div>
					<div class="c2r">
						<h4>2012</h4>
						<!-- 2012 Essentials -->
						<div class="essentials">
						    <div class="category leaders <%= @school.essentials.where("category = 'leaders' AND year_to=2012").first.rating.tr(' ','-') %>" 
						    	title="<%= @school.essentials.where("category = 'leaders' AND year_to=2012").first.rating.capitalize %>">
						    	<span class="title">Effective leaders</span>
						    </div>
						    <div class="category teachers <%= @school.essentials.where("category = 'teachers' AND year_to=2012").first.rating.tr(' ','-') %>" 
						    	title="<%= @school.essentials.where("category = 'teachers' AND year_to=2012").first.rating.capitalize %>">
						    	<span class="title">Collaborative teachers</span>
						    </div>
						    <div class="category instruction <%= @school.essentials.where("category = 'instruction' AND year_to=2012").first.rating.tr(' ','-') %>" 
						    	title="<%= @school.essentials.where("category = 'instruction' AND year_to=2012").first.rating.capitalize %>">
						    	<span class="title">Ambitious instruction</span>
						    </div>
						    <div class="category environment <%= @school.essentials.where("category = 'environment' AND year_to=2012").first.rating.tr(' ','-') %>" 
						    	title="<%= @school.essentials.where("category = 'environment' AND year_to=2012").first.rating.capitalize %>">
						    	<span class="title">Supportive environment</span>
						    </div>
						    <div class="category families <%= @school.essentials.where("category = 'families' AND year_to=2012").first.rating.tr(' ','-') %>" 
						    	title="<%= @school.essentials.where("category = 'families' AND year_to=2012").first.rating.capitalize %>">
						    	<span class="title">Involved families</span>
						    </div>
						</div>
		                <!-- /2012 Essentials -->
					</div>
                </div>
                
                <p class="clear mute">Source: <a href="https://cps.5-essentials.org/2012/s/<%= @school.cps_id.to_s %>">5Essentials</a></p>
            </div>
            <div class="dataset">
                <h4>How stable has the school been?</h4>
                <p>Probation staus + mobility + enrollment trends. Need explanation. Atur, con nonsent offic tem fugita volestibus mo moluptio volore ut elloressi eium ius et in eatur se volup tatem exeratur qui derepud icatur More...</p>
                
                <ol class="probation">
	                <li class=<%= @school.probations.where("year_from=1996").first.status%>>
	                	<span class="status"><%= @school.probations.where("year_from=1996").first.status%></span> 
	                	<span class="from">&lsquo;96</span>
	                	<span class="to">&lsquo;97</span>
	                </li>
	                <li class=<%= @school.probations.where("year_from=1997").first.status%>>
	                	<span class="status"><%= @school.probations.where("year_from=1997").first.status%></span> 
	                	<span class="from">&lsquo;97</span>
	                	<span class="to">&lsquo;98</span>
	                </li>
	                <li class=<%= @school.probations.where("year_from=1998").first.status%>>
	                	<span class="status"><%= @school.probations.where("year_from=1998").first.status%></span> 
	                	<span class="from">&lsquo;98</span>
	                	<span class="to">&lsquo;99</span>
	                </li>
	                <li class=<%= @school.probations.where("year_from=1999").first.status%>>
	                	<span class="status"><%= @school.probations.where("year_from=1999").first.status%></span> 
	                	<span class="from">&lsquo;99</span>
	                	<span class="to">&lsquo;00</span>
	                </li>
	                <li class=<%= @school.probations.where("year_from=2000").first.status%>>
	                	<span class="status"><%= @school.probations.where("year_from=2000").first.status%></span> 
	                	<span class="from">&lsquo;00</span>
	                	<span class="to">&lsquo;01</span>
	                </li>
	                <li class=<%= @school.probations.where("year_from=2001").first.status%>>
	                	<span class="status"><%= @school.probations.where("year_from=2001").first.status%></span> 
	                	<span class="from">&lsquo;01</span>
	                	<span class="to">&lsquo;02</span>
	                </li>
	                <li class=<%= @school.probations.where("year_from=2002").first.status%>>
	                	<span class="status"><%= @school.probations.where("year_from=2002").first.status%></span> 
	                	<span class="from">&lsquo;02</span>
	                	<span class="to">&lsquo;03</span>
	                </li>
	                <li class=<%= @school.probations.where("year_from=2003").first.status%>>
	                	<span class="status"><%= @school.probations.where("year_from=2003").first.status%></span> 
	                	<span class="from">&lsquo;03</span>
	                	<span class="to">&lsquo;04</span>
	                </li>
	                <li class=<%= @school.probations.where("year_from=2004").first.status%>>
	                	<span class="status"><%= @school.probations.where("year_from=2004").first.status%></span> 
	                	<span class="from">&lsquo;04</span>
	                	<span class="to">&lsquo;05</span>
	                </li>
	                <li class=<%= @school.probations.where("year_from=2005").first.status%>>
	                	<span class="status"><%= @school.probations.where("year_from=2005").first.status%></span> 
	                	<span class="from">&lsquo;05</span>
	                	<span class="to">&lsquo;06</span>
	                </li>
	                <li class=<%= @school.probations.where("year_from=2006").first.status%>>
	                	<span class="status"><%= @school.probations.where("year_from=2006").first.status%></span> 
	                	<span class="from">&lsquo;06</span>
	                	<span class="to">&lsquo;07</span>
	                </li>
	                <li class=<%= @school.probations.where("year_from=2007").first.status%>>
	                	<span class="status"><%= @school.probations.where("year_from=2007").first.status%></span> 
	                	<span class="from">&lsquo;07</span>
	                	<span class="to">&lsquo;08</span>
	                </li>
	                <li class=<%= @school.probations.where("year_from=2008").first.status%>>
	                	<span class="status"><%= @school.probations.where("year_from=2008").first.status%></span> 
	                	<span class="from">&lsquo;08</span>
	                	<span class="to">&lsquo;09</span>
	                </li>
	                <li class=<%= @school.probations.where("year_from=2009").first.status%>>
	                	<span class="status"><%= @school.probations.where("year_from=2009").first.status%></span> 
	                	<span class="from">&lsquo;09</span>
	                	<span class="to">&lsquo;10</span>
	                </li>
	                <li class=<%= @school.probations.where("year_from=2010").first.status%>>
	                	<span class="status"><%= @school.probations.where("year_from=2010").first.status%></span> 
	                	<span class="from">&lsquo;10</span>
	                	<span class="to">&lsquo;11</span>
	                </li>
	                <li class=<%= @school.probations.where("year_from=2011").first.status%>>
	                	<span class="status"><%= @school.probations.where("year_from=2011").first.status%></span> 
	                	<span class="from">&lsquo;11</span>
	                	<span class="to">&lsquo;12</span>
	                </li>
	                <li class=<%= @school.probations.where("year_from=2012").first.status%>>
	                	<span class="status"><%= @school.probations.where("year_from=2012").first.status%></span> 
	                	<span class="from">&lsquo;12</span>
	                	<span class="to">&lsquo;13</span>
	                </li>
	           	</ol>
                
                <div id="chart-mobility"></div>

                <div id="chart-enrollment"></div>
                
                <p class="mute">Source: <a href="http://cps.edu/SchoolData/Pages/SchoolData.aspx">Chicago Public Schools Performance Data</a></p>
            </div>
            <div class="dataset">
                <h4>Is this school really underutilized?</h4>
                <p>CPS vs Apples to Apples. Need explanation. Atur, con nonsent offic tem fugita volestibus mo moluptio volore ut elloressi eium ius et in eatur se volup tatem exeratur qui derepud icatur More...</p>
                <p class="mute">Source: <a href="http://cpsutilization.kalov.net/alt">Apples 2 Apples Alternative 2012-2013 School Utilization </a></p>
            </div>
        </div>
        
        <div class="clear"></div>
    </div>
</div>
<!-- /Content -->

